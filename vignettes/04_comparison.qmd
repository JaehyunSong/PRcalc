---
title: "Comparison"
knitr: 
  opts_chunk: 
    dev: "ragg_png"
    fig.width: 7
    fig.height: 5
    dpi: 150
---

```{r setup}
library(PRcalc)
```

## データセット

```{r dataset2}
data("jp_lower_2021") # 2021年衆院選
jp_lower_2021
```

## 計算

```{r prcalc2}
obj1 <- prcalc(jp_lower_2021, 
               m = c(8, 13, 19, 22, 17, 11, 21, 28, 11, 6, 20), 
               method = "dt")

obj2 <- prcalc(jp_lower_2021, 
               m = c(8, 13, 19, 22, 17, 11, 21, 28, 11, 6, 20), 
               method = "hare")

obj3 <- prcalc(jp_lower_2021, 
               m = c(8, 13, 19, 22, 17, 11, 21, 28, 11, 6, 20), 
               method = "sl")
```

## `compare()`：比較

### 配分結果の比較

```{r}
compare(list(obj1, obj2))
# モデルに名前を付ける
compare(list("ドント式" = obj1, "ヘア式" = obj2, "サン＝ラゲ式" = obj3)) 
# 一部の政党のみ出力
compare(list("ドント式" = obj1, "ヘア式" = obj2, "サン＝ラゲ式" = obj3)) |> 
  print(subset = c("自民", "公明", "立憲", "共産", "維新"))
# {gt}パッケージ使用 & 割合出力
compare(list("ドント式" = obj1, "ヘア式" = obj2, "サン＝ラゲ式" = obj3)) |> 
  print(prop = TRUE, use_gt = TRUE)
# 可視化
compare(list("ドント式" = obj1, "ヘア式" = obj2, "サン＝ラゲ式" = obj3)) |> 
  plot()
# 政党ごとにfacet分割
compare(list("ドント式" = obj1, "ヘア式" = obj2, "サン＝ラゲ式" = obj3)) |> 
  plot(facet = TRUE)
# 3列構成 + y軸スケール固定
compare(list("ドント式" = obj1, "ヘア式" = obj2, "サン＝ラゲ式" = obj3)) |> 
  plot(facet = TRUE, facet_col = 3, free_y = FALSE)
```

### 指標の比較

```{r}
compare(list(index(obj1), index(obj2), index(obj3)))

compare(list("ドント式"     = index(obj1), 
             "ヘア式"       = index(obj2), 
             "サン＝ラゲ式"  = index(obj3)))

compare(list("ドント式"     = index(obj1), 
             "ヘア式"       = index(obj2), 
             "サン＝ラゲ式"  = index(obj3))) |> 
  print(hide_id = TRUE)

compare(list("ドント式"     = index(obj1), 
             "ヘア式"       = index(obj2), 
             "サン＝ラゲ式"  = index(obj3))) |> 
  print(subset  = c("dhondt", "gallagher", "lh", "ad"),
        hide_id = TRUE,
        use_gt  = TRUE)
```

```{r, fig.height=7, out.height=700}
compare(list("ドント式"     = index(obj1), 
             "ヘア式"       = index(obj2), 
             "サン＝ラゲ式"  = index(obj3))) |> 
  plot() +
  ggplot2::labs(x = "値", y = "指標", fill = "割当方式")
```
